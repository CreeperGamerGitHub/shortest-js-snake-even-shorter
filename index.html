<!DOCTYPE html>
<html>
	<head>
		<title>Snake</title>
	</head>
	<body>
		<canvas width="800" height="600"></canvas>
		<script>
			let rand  = fac => Math.floor(Math.random() * fac);
			let add2d = (a, b) => [a[0] + b[0], a[1] + b[1]];
			let mod2d = (v, m) => [(v[0] % m[0] + m[0]) % m[0], (v[1] % m[1] + m[1]) % m[1]];
			let ctx   = document.querySelector("canvas").getContext("2d");
			let snake = [[8, 6]], apple = [4, 3], dir = [0, 0];
			
			document.onkeydown = e => void(
				e.key === "ArrowRight" && (dir = [ 1,  0]) ||
				e.key === "ArrowLeft"  && (dir = [-1,  0]) ||
				e.key === "ArrowDown"  && (dir = [ 0,  1]) ||
				e.key === "ArrowUp"    && (dir = [ 0, -1]) )
			
			setInterval(() => {
				snake.unshift(mod2d(add2d(snake[0], dir), [16, 12]));
				
				if(snake.slice(1, -1).find(seg => seg + "" == snake[0])) {
					snake.splice(1);
				}
				else if(snake[0] + "" == apple) {
					do {
						apple = [rand(16), rand(12)];
					} while(snake.find(seg => apple + "" == seg));
				}
				else {
					snake.pop();
				}
				
				ctx.fillStyle = "black";
				ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
				ctx.fillStyle = "red";
				ctx.fillRect(apple[0] * 50, apple[1] * 50, 50, 50);
				ctx.fillStyle = "lime";
				snake.forEach(([x,y]) => ctx.fillRect(x * 50, y * 50, 50, 50));
			}, 150);
		</script>
	</body>
</html>
